---
import type { BlogMetadata } from "../../lib/utils";
import { getReadingTime } from "../../lib/utils";

type Props = {
  blogs: BlogMetadata[];
};

function formatDate(d: Date) {
  const fullDate = d.toLocaleString("en-us", {
    month: "long",
    day: "numeric",
    year: "numeric",
  });

  return fullDate;
}

const pubAt = (d: Date) => {
  const date = new Date(d);
  return formatDate(date);
};

const { blogs } = Astro.props;
---

<ul id="blog-list" class="flex flex-col justify-center gap-4">
  {
    blogs.map((post) => {
      const readingTime = getReadingTime(post.body ?? "");
      const tags = post.data.tags || [];
      const tagsString = tags.join(", ");

      return (
        <li
          class="project-cascade"
          data-title={post.data.title}
          data-summary={post.data.summary}
          data-tags={tagsString}
        >
          <a
            title={post.data.title}
            href={`/blog/${post.id}`}
            class="group flex w-full flex-1 select-none flex-col gap-3 rounded-2xl bg-secondary-900/10 px-5 py-4 transition-all hover:bg-secondary-900/20 hover:brightness-125 md:p-6 dark:bg-secondary-100/10 dark:hover:bg-secondary-50/20"
          >
            <div class="flex flex-col gap-2">
              <h2 class="line-clamp-2 w-full text-pretty font-semibold text-md md:text-lg group-hover:text-primary-700 dark:group-hover:text-primary-500 transition-colors">
                {post.data.title}
              </h2>
              <p class="text-sm text-neutral-600 dark:text-neutral-400 line-clamp-2">
                {post.data.summary}
              </p>
            </div>

            <div class="flex flex-wrap items-center gap-2 text-xs text-neutral-500 dark:text-neutral-500">
              <time datetime={post.data.publishedAt.toISOString()}>
                {pubAt(post.data.publishedAt)}
              </time>
              {readingTime && (
                <>
                  <span>•</span>
                  <span class="flex items-center gap-1">
                    <svg
                      class="w-4 h-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                    {readingTime} min read
                  </span>
                </>
              )}
              {tags.length > 0 && (
                <>
                  <span>•</span>
                  <div class="flex flex-wrap gap-1.5">
                    {tags.slice(0, 3).map((tag) => (
                      <span class="px-2 py-0.5 rounded-full bg-primary/20 text-neutral-700 dark:text-neutral-300 font-medium">
                        {tag}
                      </span>
                    ))}
                    {tags.length > 3 && (
                      <span class="px-2 py-0.5 text-neutral-600 dark:text-neutral-400">
                        +{tags.length - 3} more
                      </span>
                    )}
                  </div>
                </>
              )}
            </div>

            <div class="flex items-center gap-2 text-primary-700 dark:text-primary-500 text-sm font-medium group-hover:translate-x-1 transition-transform">
              Read article
              <svg
                stroke="currentColor"
                fill="currentColor"
                stroke-width="0"
                viewBox="0 0 448 512"
                height="1em"
                width="1em"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z" />
              </svg>
            </div>
          </a>
        </li>
      );
    })
  }
</ul>

